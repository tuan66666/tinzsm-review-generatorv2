<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>訂單評價</title>
</head>

<body style="font-family:Arial; text-align:center; padding:40px;">

<h2>訂單評價系統</h2>

<button onclick="submitReview()" 
style="padding:12px 24px; font-size:16px; background:#4CAF50; color:white; border:none; border-radius:6px; cursor:pointer;">
產生圖片並送出
</button>

<br><br>

<!-- Canvas -->
<canvas id="canvas" width="600" height="400" 
style="border:1px solid #ddd; display:none;"></canvas>

<!-- 進度條 -->
<div id="progress-container" style="display:none; width:100%; max-width:400px; margin:20px auto;">
  <div style="width:100%; background:#eee; border-radius:10px; overflow:hidden;">
    <div id="progress-bar" 
    style="width:0%; height:20px; background:#4CAF50; transition:width 0.2s;"></div>
  </div>
  <p id="progress-text" style="margin-top:8px; font-size:14px;">
    請稍等幾秒鐘...
  </p>
</div>

<script>

const GOOGLE_SCRIPT_URL = "YOUR_GOOGLE_SCRIPT_URL";

async function submitReview() {

  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  // 1️⃣ 產生圖片
  ctx.fillStyle = "#ffffff";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "#333";
  ctx.font = "28px Arial";
  ctx.fillText("訂單評價完成", 180, 180);

  ctx.font = "18px Arial";
  ctx.fillText("感謝您的支持 ❤️", 210, 230);

  const imageData = canvas.toDataURL("image/png");

  // 2️⃣ 顯示進度條
  const progressBar = document.getElementById("progress-bar");
  const progressContainer = document.getElementById("progress-container");

  progressContainer.style.display = "block";

  let progress = 0;

  const interval = setInterval(() => {
    if (progress < 95) {
      progress += Math.random() * 5;
      progressBar.style.width = progress + "%";
    }
  }, 200);

  try {

    // 3️⃣ 自動上傳
    await fetch(GOOGLE_SCRIPT_URL, {
      method: "POST",
      mode: "no-cors",
      body: JSON.stringify({
        image: imageData,
        fileName: "review_" + Date.now() + ".png"
      })
    });

    clearInterval(interval);
    progressBar.style.width = "100%";

    setTimeout(() => {
      alert("您的訂單評價已送出，期待再次為您服務!!!");
      progressBar.style.width = "0%";
      progressContainer.style.display = "none";
    }, 500);

  } catch (err) {

    clearInterval(interval);
    alert("發生錯誤，請稍後再試");
    progressBar.style.width = "0%";
    progressContainer.style.display = "none";
  }
}

</script>

</body>
</html>
